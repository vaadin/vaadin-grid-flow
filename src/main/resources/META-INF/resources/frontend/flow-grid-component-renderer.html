<link rel="import" href="flow-component-renderer.html">

<dom-module id="flow-grid-component-renderer">  
  <script>
  class FlowGridComponentRenderer extends FlowComponentRenderer {
    static get is() { return 'flow-grid-component-renderer'; }

    constructor(){
      super();
      this.loadingListener = evt => this._onLoadingChanged(evt);
    }

    connectedCallback() {
      super.connectedCallback();
      let grid = this._getGrid();
      if (grid) {
        grid.addEventListener('loading-changed', this.loadingListener);
      }
    }

    disconnectedCallback() {
      let grid = this._getGrid();
      if (grid) {
        grid.removeEventListener('loading-changed', this.loadingListener);
      }
      super.disconnectedCallback();
    }

    _getGrid() {
      if (this.parentElement && this.parentElement.parentElement && 
          this.parentElement.parentElement.tagName === 'VAADIN-GRID'){
        return this.parentElement.parentElement;
      }
      return null;
    }

    _onLoadingChanged(evt){
      let loading = !!evt.detail.value;
      if (loading) {
        this.style.visibility = 'hidden';
      } else {
        this.style.visibility = 'visible';
      }
    }
    
    onComponentRendered(){
      let grid = this._getGrid();
      if (grid) {
        grid.$connector.asyncNotifyResize();
      }
    }
  }
  window.customElements.define(FlowGridComponentRenderer.is, FlowGridComponentRenderer);
  </script> 
</dom-module>
